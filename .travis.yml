language: python
python:
- '2.7'
cache:
  directories:
  - $HOME/google-cloud-sdk/
env:
  global:
  - GAE_PYTHONPATH=${HOME}/.cache/google_appengine PATH=$PATH:${HOME}/google-cloud-sdk/bin
    PYTHONPATH=${PYTHONPATH}:${GAE_PYTHONPATH} CLOUDSDK_CORE_DISABLE_PROMPTS=1
  - secure: UIAZe5OzfS9/yySv/5b5LMWruJaSB3478X1wZnmfmDGrZgQwz/NE9sfuxaLa88gBcqKSwqJCbbR2K8qwzoB/wup2FcLAwfBmevvYZ8Kw1nTv+tq7PZHz+eMvoKD0LIRgBQUFH2H9MyQ71GopBK9GEaO18NLAKG+cijNjqHA/x6nlwr7w6PxvWU8uFhLPp8ycJBgBS/igRcCKSVPikJsX8XJhTuLfQQ9e+CmGOAXn027RhXEYvY2sxIM9ouNbPqMqUeTQYelM0HjM9NuSvG9i3SryWeP9ixkPqma3qFqXB3yDbR1cTU/CBejlqz6W+0cg9xBt3ab21mSiPMNc0+FVNBmzcK29nIGwkGyqddpfHn38KzJsOxQQE/CwNYSphumILk/6zOpV9bYaIEAkLtLIyLoVktvY28XME++tFae6QSM4w+WsGh8ZGpMTAETqasL99woOgv5O4yCYemLSqSRxIFUnXY0yXz8xxeHcwFu3TQCSAx7C8/iqmlsegejAi3DfOOQY0t0TvvO6MTiqwbiyD6SUtC9QWDFxC5SAkDbH3/z31Ooxs4ahDrsWNHIFYSey+LwX7XE2JpmQxMq4AlWl8cHxvAbC7mVX5TPHjNCdYKham7CT9Xo61yn/S0PY+ZqhtCXROgj89DwK29lG8dPqhg/2hc82DoMskLJLqjD5fr8=
  - secure: XQeo7VNNlqx+Jv0f14b4I0Dfam6Al8pDHTGo2O1opOK/u6D0b9gwMbu34sxQI2AmKi8tjHJbeYtXavPkJmnASw7uw8uHcRV/sUtCFP6T+1KP7FfPYZObZMtIWIib4Ba1/HeBO6sm1HKfyPAGcsGvAsOP1uGfjgH6T6Bj+O+fSJm8pAPEdr/m3qLZLYr+wKpRjh6hoV3Qptpq4hKMG51lTnc0RgBvMqB+JXuWFg3FKCUxAu/4gzppV0EZK6xAEWsAOilfkOVgeRyFjwrTKxGDjx9SAMHrmSOsKYUILdYQAbgSJ2fEJ9hUHWhmvmZO9KJPWirxZnfLiGA4Bz7EF4NA9yfJmpZqKQdAZRpUdJElOiaYmovaaitul7c5lLFRJH0HnPAVHg8dMNdSKs8VsdpeRD138gKKKkmrK9dfHBrEDrm//kOEOtLnB8NPrXiyNGSfDhw7byZpT6k2XXmK1CSedTeA+0+XYDW704Vjsgi+2ks6LGGF2ZUB70fei0wC7oWzVVgOgTHtt2P2mOW7resrdwKrHbtTxrhmOgWDk6ZjtGNG9faCNH4AaUF5fOigj9YZ7GbGeG7sTRHfw/PsMFP8F6fbF4NVDO0ryrP0iE77VMDPec37e4OLJnFVnjoq3InfqRPwaprUTZlInMXeH2JNOqiwiPksuO0BHcvgKtropJU=
  - secure: nGhZy2GUyaG1A94x1TtqNSdRRGtybEgqabW1RVAoK9eEnKXPMygimOPpNCBTPwkUfJu+ogUB7uP4YRq6S2wOV1HtAYFSW4xlOFu505lEkxl478o6tUaHbI5SswJr6/qOxMZn9pHjYYO4PII+hNlrLnVff4EaRTp5ff93u5kEcf2aLWtGtRZwzxusIvEIvPZlN9KjxX1iPf84txkF1pWKPVugMRV5RV/kguIx7EvVX0Aj9mbyHwBiftG3CICgR6vVtuA9ge3v+Sb9ik2d/BuTuueMzt2dxub7BreBMkvhjBc3jmnEJQo7WgljELDENjnO//Wd2O0mely+nY0yyssLkcjPXGC/C2JcLsSRJ/FjH4RT34U/eZNozDcEpDsullsBLGiRRR25o9ihZIbWPzQPGkCmwfa2l2PR5HD73Y8AjSO9/qnVeZEtKvCOA89uhnUOnjB9T/yYepzoQXmQGBivXSPRN4b0WT23SK+OMWu48IVVipdDNEMMZfVQJKMuaxJghcdy5/qAdsQKAlvd8WXX0jSFqvgGxTV7gamO/QlR3GTR5K+FZd98EfzttrU/Aff/YVEEeVWMknTG8Y2Rg2r/0Q8/wq26WUYJp3qxJxvsbhL82vjJeBt4emwl3JekGi7LiHvi0FHqheYtEHSvdFeQXfMzYUcUBshbKdTaaIkSqow=
  - secure: fu83tpVHHMHGzkKd2J0aEgwGaX0ZGI90thrQ9gxhdDShX24zYb3RZqRb6WAMzGkB4rpBlH+k/T/ud0dueHfTorY366R7pJkkG6BYnv1LGJuENSTOjAt/eZm72d0IZPzS8lHhwBqUsP0EN1A1o8M6MNWFN8jGBcvD5GO4Mtk7QUQ/0v8mHCl6NRQPLbPfMNIk3at9Jg+Yr5fZjWA/qX3orchR1pp7ITl5xUbGyEJfBrKPmNjiZloDDjXeftlOLZPs5UQKeLnJEw0H6vP47RxBWwDSVtZfBx45siB8PKXukQ0ezReNowMMJZFZ+WIAgBJ18kXjr6LuTmposeBEkyBQD5XqPaw4cx7lZ7RRXRFZsw2hDHLUiZBJwtE9ZDuW5hvrcbZyACW3reCFBKVVD/1WeyJOM5THhSGB106ebWzzArzkE04XBIQg4UzKD4JniZh4fPXMwLZ0xRco7P/s5nAxiTxIjZS3sgZ323fNUsJG7HAo1tMLtuTTsjrvHlQN+2MvXwVTJNeLp6stfaJf88MdqDAiJ5RbourqJZIDe2OnuuPmlq0EQTe0Q2gVAzC35/xU82W5RPAb1FTOjIboQJ4R0gXgrPTeGUVFTYH9MSG/VPtaJgGMuDlxLYLvaMEymAlbxzY1Tl/CIERW8QBeaF8cjejOSV11K0dckKXhMuZ9hBU=
  - secure: vfvKhcCvVGXTQOV+vL+//k9xzGMJOSivYq/X2tUBCZ7Q6PTEoC1Rdj9I6twZjCoc1s143m/TfcsDBdZ2soklM7+yWo3hMmXrpgAioRnvY3OCZH0GkD3QHGlivPbcymjsYMrxb0EytLLvHvjRYhYfO5JxgDlnOPkXRxIRMh/WYznowpamieKqTCymvTA1glCFvO7+a/FR1AGUGsjjL6i46y8lQegZ+LDiQdOqaDj+hTuG/SPOUQ9eI9QD+LGmVlchngPfCILZbsfzdWGM3pQBwPm65B7JDiPBglk1m99XuW680bnHZFsMdVwDZ1Bi05r0E+FukuzIS87opGJdghlNuh6pRmZZZEeadc2DUh8mLRK+SuylOnBZFmDn7+VlqIUGuMv6SuoDcxD/MJFUZNyyVOhFgMOXTFfregmW2njNcC4Kb+JN8baZupvCArCFqc7xEA5KeqvGYL67QEupwHm2d6tBC2NOQGHScSbXItO8QrwfXNE88wXH6VZzgojd4cFSzOtn+FUbq/C5xGhuy0nc0q6gG1bCYnJaGwz6Ued0utSiMKNBcdmgaq5lfhUT+QmCzqRrM1DDwJ57jdu7m06am5QTDKI3LR8NMa+DF95LXmSXYhcVTADMdNHPLBUn8rFDcRk7DZjRWOMmKI2YuKtxBi865o1F76qDGIKMEPLlxzw=
  - secure: RdQcphLQkiSTkeRC5JWzFPeH4btDMNZLRs0NuIBXyl6npMSZBgeaShDyjoJZU58U31JykcRhEBQcW+n7FEF6fgcK6O2NM6iQ16vZHdhJ2GluWL4BeUI4mjnbusTGzmTp45Le8Nyd2fiwZ0wbPn2yHbWqK1KZRc4M0bWSSdV+gUoVPWYEQdWLmMATtCQ/8A8JHI0QMwiD3P1JvKjuUWaHwjYLwXE718Zex/enxR9sunWvSXnSzYpT81554fSZzfzLjqmPSbyfHvo6YNDKPM4mV+IyKi8c/5xKsE8vgWwhILY/T9bXSAHaEkAdfzHdZ8X9zwzR4ELhyF4/9+nSTETDgqkrzm8+JKzLZKwditJOlSsPq1ObPeuleJ6bAL6MepnxZOT7guuSw610C6L3B1nCLXXPttN6f3Y6ge2Rs4W6oHmb3uY7kMAEUVkKn1YrZv96zvrXGufpFbJlBtmHmAvSLuorL6LkBZZYM2VjxyRaBusVlRtT83Owpe4WbMMiDw6mKVsAJJhRKzVYY2qgG68Xdeu7uLo83IClIgb5TEIaLOgKfV7JHQbCF/GJVJpyjyQjLsPE5/WC+sHAwkHNWVKi1O84qdME+2d4BqJ9eOb/7OZaB7LNnEXrP9rSq8Ofyzx9WFeTyo/BOAejp4xls+kJE46BLNisfrb73ko0r2eP8YM=
  - secure: KuT4bwTOmEqid2BFgAj/mOxkpG3tjAiNWneTiuHT56cSFNyrzK03wtwCfLdcPYzpNsac52NlZSyNQkDR8hkL+71oExDuwHxsUAE9GpNC0FT/8DUIqsaB7mjf6ir90UzhTiu2ZunME/B1HdqZi6z5v2m56OFJV2U41YLT9PmmbE1BvLk6aNZLtdO6Oy0gRTITVWDv8+fVirC+TNL1hpG8dv8zOi42csDTpbttfUkfzElNZUJHjaoQwl/1tqg5s8rCMr4SNP7op7/iaecKU57NO5CrLdEqKYo4H1hiqiFGjLkRg3pSuEYWUMrXnGjiqEero1SkO0RnP+IihQiZLLLdugTaTWRJbUoBFdbDGx9XHUzmsExGvMHrl69Ev1cgmoea8tJM4ndCZDu4Qif5tEN3lB/iJyyUv1Uk9uW0AUCDGdK2TMKV8J8/js6Fn29WsHpn4AN+lZ1fGy/17E9ajflqZzF1zOn7OKXoNIwSzuSBz1uWr1Ez7Vyrg2YqSwm/jS3qQGgeTyLfPtqD1tYUsgv/GBnbjW6D/YLARSUuSgbgJZ2Y6u80T3SB5XGvEijbGDMZKUu1PtlPe65DQYgK3EjKhE5nLQgSiQCoukATeYgqSXHuHJLccsDFChoSlo+pIbbe/S3s1plp5P049ZDp+4paG8shfyLuk9R2qsyx04jHis8=
services:
- elasticsearch
before_install:
- if [ ! -d "${GAE_PYTHONPATH}" ]; then python tools/scripts/fetch_gae_sdk.py $(dirname
  "${GAE_PYTHONPATH}"); fi
- if [ ! -d "$HOME/google-cloud-sdk/bin" ]; then rm -rf $HOME/google-cloud-sdk; export
  CLOUDSDK_CORE_DISABLE_PROMPTS=1; curl https://sdk.cloud.google.com | bash; fi
- source /home/travis/google-cloud-sdk/path.bash.inc
- openssl aes-256-cbc -K $encrypted_496d8ec6abbd_key -iv $encrypted_496d8ec6abbd_iv
  -in credentials.tar.gz.enc -out credentials.tar.gz -d
- tar -xzf credentials.tar.gz
- mv .env app/
- gcloud auth activate-service-account --key-file service_account_secret.json
install:
- pip install -r requirements_test.txt -t lib_tests
- pip install -r app/requirements.txt -t app/lib/
- gcloud config set project profile-ciandt
- gcloud -q components update gae-python
before_script:
- sleep 10
script:
- gcloud version
- python --version
- nosetests -v --nocapture --nologcapture tests
after_success:
- sed -i bak -e "s/BUILD_NUMBER/$TRAVIS_BUILD_NUMBER/g" app/backend/version.py
- cd app/
- gcloud app deploy -v production --promote --verbosity=info
- python e2e_test/test_version.py
